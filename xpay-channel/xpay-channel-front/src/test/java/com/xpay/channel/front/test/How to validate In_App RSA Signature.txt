Steps to validate signature in payment data: 


1. Get Apple G3 root CA certificate from this URL: https://www.apple.com/certificateauthority/ and load the certificate into a key store

2. Build a certificate path from certificate chain in PKCS 7 signature

3. Verify the certificate path is valid using the key store built on step 1.

4. the signature was computed on input: Base64.decode(wrappedKey)+Base64.decode(encryptedData)+Hex.decode(transactionID).  It is a PKCS7 signaure.  Signature's algorithm, Apple's In-App payment server's signing key certificate and it's sub-ca certificate are included in the signature tag in JSON. 

These are the recommended java classes to use for signature validation: Bouncy Castle Library is needed to get these classes.

CertificateFactory
CertPathValidator
PKIXCertPathValidatorResult
SignerInformationStore
X509CertificateHolder
SignerInformation
CertPath
PKIXParameters
CMSSignedData
Store




A useful link for payment token:

https://developer.apple.com/library/ios/documentation/PassKit/Reference/PaymentTokenJSON/PaymentTokenJSON.html#//apple_ref/doc/uid/TP40014929

Here is the difference between ECC solution and RSA solution. 

1. header:

RSA replace the “ephemeralPublicKey” in ECC with key  “wrappedKey”.  


2. the encrypted payment Data 

a new key pair was added paymentData  
paymentData
payment data dictionary
Detailed payment data.
encryptedPINData  the encrypted PIN

The new paymentData dictionary is as below:

"paymentData":{
		"emvData":"nyYIwd01kMbopryfNgIAAYECACGDaIbCdFKt+hWIdOCx8ilI6n4W/dhQfHsoA/4eB9/9eLewM0i7wuozU+Cm/XazoUeWde9aNrNxrTkMwSlneoixeKRm4/DIF9bYIz98dj/slBB/PSN1u2CsJxuLLuGFobvh8Ne6i+2uoWzo”
		"encryptedPINData":"8110258dc2ea3c13e241b4b1c4fe67b2b2e482080021ffffffffffff”
	},


3. the signature of is using  algorithm of SHA256withRSA. The signature is based on same input tags as ECC. 


4. the “version" key pair’s value is RSA_v1

5. The asymmetric algorithm used to encrypt the symmetric key is RSA/ECB/OAEPWithSHA256AndMGF1Padding 


Please see a sample out the payment token using RSA solution below 

{"version":"RSA_v1","data":"JBb9qEum3LGrSjn8YQ6bxW663XR1G+kLejpsNbVdWzQpA2sRz60At0VBaWGkgD8+fy3l1+LF4p77JHI1GDK14cpyodlhLtqv04Vf50cWICl1+Zx14IgOtJtu5MBppLd7oeWRhgCfVDi6NzW2on2sBoUBjlxfumRZjjGBRyQAG0RkMctTjLiOLcJjPfHeMNmR9vv2q0d1DPz7Xx0Jv4JJm1WRvd5yPyUPvPNc+xK/wkAv8g8x9FxOU8LQ5RFzzqo/+eW3fk5H7Mp/Nk2roirYm++BM9A7VvvafPwF+RxdpiJZbziV8irrLWXupXIFY511i5ypceXZynJtnHAnUDXfeQj7FlhBKH8UR8z6Zkc/ei59Qp0dOv9rGTEuiOzpJ2KI1skJNUPOJPppjDEyD4AQPW/oP1FbwJEPXCgjHMaXS9+TT2OJH2tbHTQpqW7EJxkUzeOV/eZx+0dXYda9iamemIpEDOyqApeBoVaw1LX5sbDokUwdDHinzLYlQtazHlF8dIam+Rh7uDq1u0m72D+Cq/hGbMjrRpIWMZB9w8DEpjZ7CZWlUmNg5zoT/onePpUNpbfw3XZeWykScy3bvHRqkL7t2YgMEUELocxWmuXqruY03toPmSMCp3Okgl+P0Lun95ThGfvQSRLnpX1FmEm9","signature":"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","header":{"applicationData":"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855","transactionId":"a80753bee5ad57683ba47890cc00cf5eeb946dcb74bc60256e64e10f696c9d10","wrappedKey":"uKLS7Ulne0QzesIigCkM/HJSMUwk3SLGIMoxswnalCZhWGbo/QJz+4V8AjB+pekA1H+xBuMyaWHKjYA09ojg6o6jlPKlXkSQtGnl7h89/AHnlpZgENYwATA2XwqdAnjFLKcAcvA67Th3nYk1duZbAyesAS+t71hocGU6hHjW7GglDhnc85wp/NjAcDWAOzFcAcpP5WHX9OCrgqhw90DRfwWzi8QJJwn6mnYkaz9mtKRAdfSsV7S7Alh+Dj7NNbiMyAHXU01bcErEjovGcCxELEzQxojloh4P9EwOX9Q1XKvNLWD4xA8TVyAD7lWcEXIKElU0gzFwuIdZhndnyF5B3g==","publicKeyHash":"ZCrntHY7uI8Nt2uzA6/rNb0teJ5VcKbodWwELOtXdhw="}}
 
